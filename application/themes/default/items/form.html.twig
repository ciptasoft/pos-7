<div id="tabs">
    <ul>
        <li><a href="#tabs-1">Básico</a></li>
        <li><a href="#tabs-2">Clasifica</a></li>
        <li><a href="#tabs-3">Imágenes</a></li>
    </ul>
    <div id="tabs-1">
        <ul id="error_message_box"></ul>
        {{ form_open('items/find_item_info/'~item_info.item_id,{'id':'item_number_form'}) }}
        {{ form_close() }}
        {{ form_open('items/save/'~item_info.item_id,{'id':'item_form'})}}
        <fieldset id="item_basic_info">
            <legend>{{ line("items_basic_information")}}</legend>

            <div class="form-group">
                {{ form_label(line('items_almacen')~':', 'almacen',{'class':'required small_wide'})}}
                {{ form_dropdown('almacen_id', almacenes, selected_almacen,"id = 'almacen_id' class='form-control'")}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_item_number')~':', 'name',{'class':'wide'})}}
                {{ form_input({
		'name':'item_number',
		'id':'item_number',
		'value':item_info.item_number,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_name')~':', 'name',{'class':'required wide'})}}
                {{ form_input({
		'name':'name',
		'id':'name',
		'value':item_info.name,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_category')~':', 'category',{'class':'required wide'})}}
                {{ form_input({
		'name':'category',
		'id':'category',
		'value':item_info.category,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_supplier')~':', 'supplier',{'class':'required small_wide'})}}
                {{ form_dropdown('supplier_id', suppliers, selected_supplier,"class='form-control'")}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_cost_price')~':', 'cost_price',{'class':'required wide'})}}
                {{ form_input({
		'name':'cost_price',
		'size':'8',
		'id':'cost_price',
		'value':item_info.cost_price,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_unit_price')~':', 'unit_price',{'class':'required wide'})}}
                {{ form_input({
		'name':'unit_price',
		'size':'8',
		'id':'unit_price',
		'value':item_info.unit_price,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-inline">
                {{ form_label(line('items_tax_1')~':', 'tax_percent_1',{'class':'small_wide'})}}
                {{ form_input({
		'name':'tax_names[]',
		'id':'tax_name_1',
		'size':'6',
                    'value': item_tax_info[0]['name'] is not empty ? item_tax_info[0]['name'] : default_tax_1_name })
                }}
                {{ form_input({
		'name':'tax_percents[]',
		'id':'tax_percent_name_1',
		'size':'3',
		'value': item_tax_info[0]['percent'] is not empty ? item_tax_info[0]['percent'] : default_tax_1_rate}
	)}}
                %
            </div>

            <div class="form-inline">
                {{ form_label(line('items_tax_2')~':', 'tax_percent_2',{'class':'small_wide'})}}
                {{ form_input({
		'name':'tax_names[]',
		'id':'tax_name_2',
		'size':'6',
		'value': item_tax_info[1]['name'] is not empty ? item_tax_info[1]['name'] : default_tax_2_name}
	)}}
                {{ form_input({
		'name':'tax_percents[]',
		'id':'tax_percent_name_2',
		'size':'3',
		'value': item_tax_info[1]['percent'] is not empty ? item_tax_info[1]['percent'] : default_tax_2_rate}
	)}}
                %
            </div>


            <div class="form-group">
                {{ form_label(line('items_quantity')~':', 'quantity',{'class':'required wide'})}}
                {{ form_input({
		'name':'quantity',
		'id':'quantity',
		'value':item_info.quantity,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_reorder_level')~':', 'reorder_level',{'class':'required wide'})}}
                {{ form_input({
		'name':'reorder_level',
		'id':'reorder_level',
		'value':item_info.reorder_level,
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_description')~':', 'description',{'class':'wide'})}}
                {{ form_textarea({
		'name':'description',
		'id':'description',
		'value':item_info.description,
		'rows':'5',
		'cols':'17',
                'class':'form-control'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_allow_alt_desciption')~':', 'allow_alt_description',{'class':'wide'})}}
                {{ form_checkbox({
		'name':'allow_alt_description',
		'id':'allow_alt_description',
		'value':1,
		'checked':(item_info.allow_alt_description)? 1  :0,
                'class': 'checkbox-inline'}
	)}}
            </div>

            <div class="form-group">
                {{ form_label(line('items_is_serialized')~':', 'is_serialized',{'class':'wide'})}}

                {{ form_checkbox({
		'name':'is_serialized',
		'id':'is_serialized',
		'value':1,
		'checked':(item_info.is_serialized)? 1 : 0,
                'class':'checkbox-inline'}
	)}}
            </div>

            {{ form_submit({
	'name':'submit',
	'id':'submit',
	'value':line('common_submit'),
	'class':'btn btn-success'})
            }}
        </fieldset>
        {{ form_close() }}
    </div>
    <div id="tabs-2">
        <p>Ingrese la cantidad que tiene de cada Item.</p>
        {{ form_open('items/save_clasifica/'~item_info.item_id,{'id':'item_clasifica_form','class':'form-group'})}}    
        {{ form_label('Tallas')}}
        <div class="form-group form-group-sm">
            {{ form_hidden({'id_color':id_color,'id_talla':id_talla}) }}
            {% if tallas is not empty %}
                {% for talla in tallas %}                    
                    <div class="row">
                        <div class="col-sm-7 col-xs-7 nopadding">
                            {{ form_hidden({'talla_id[]':talla.item_category_id}) }}
                            {{ form_input({
                        'name':'talla_nombre[]',
                        'value':talla.name,
                        'class':'form-control col-sm-8 col-xs-8',
                        placeholder:"Talla"}
                )}}
                        </div>
                        <div class="col-sm-2 col-xs-2 nopadding">
                            {{ form_input({
                        'name':'talla_cantidad[]',
                        'value':talla.quantity,
                        'class':'form-control col-sm-2 col-xs-2',
                        'placeholder': 'Cantidad'}
                )}}
                        </div>
                        <div class="col-sm-3 col-xs-3">
                            <button id="{{loop.first == 1 ? 'btn_talla_add' : 'btn_talla_remove'}}" type="button" class="btn btn-default btn-xs" aria-label="Left Align">
                                <span class="{{loop.first == 1 ? 'glyphicon glyphicon-plus-sign' : 'glyphicon glyphicon-erase'}}" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {%else%}
            <div class="row">
                <div class="col-sm-7 col-xs-7 nopadding">
                    {{ form_hidden({'talla_id[]':''}) }}
                    {{ form_input({
		'name':'talla_nombre[]',
		'value':item_info.marca_nombre_1,
                'class':'form-control col-sm-8 col-xs-8',
                placeholder:"Talla"}
	)}}
                </div>
                <div class="col-sm-2 col-xs-2 nopadding">
                    {{ form_input({
		'name':'talla_cantidad[]',
		'value':item_info.marca_cantidad_1,
                'class':'form-control col-sm-2 col-xs-2',
                'placeholder': 'Cantidad'}
	)}}
                </div>
                <div class="col-sm-3 col-xs-3">
                    <button id="btn_talla_add" type="button" class="btn btn-default btn-xs" aria-label="Left Align">
                        <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                    </button>
                </div>
        {# form_label('Colores')#}
                <div class="col-sm-7 col-xs-7 nopadding">
                    {{ form_hidden({'color_id[]':''}) }}
                    {{ form_input({
		'name':'color_nombre[]',
		'value':item_info.marca_nombre_1,
                'class':'form-control col-sm-8 col-xs-8',
                placeholder:"Nombre Color"}
	)}}
                </div>
                <div class="col-sm-3 col-xs-3 nopadding">
                    {{ form_input({
		'name':'color_valor[]',
		'value':item_info.marca_nombre_1,
                'class':'form-control col-sm-8 col-xs-8',
                placeholder:"HEX #fff000"}
	)}}
                </div>
        </div>
        {% endif %}
        </div>
       
        {{ form_submit({
	'name':'submit_clasifica',
	'id':'submit_clasifica',
	'value':line('common_submit'),
	'class':'btn btn-success'})
        }}
        </form>
    </div>
    <div id="tabs-3">
        <p>Escoja una imágen.</p>
    </div>
</div>
<script type='text/javascript'>
//validation and submit handling
    $(document).ready(function () {
        $("#tabs").tabs();

        $(function () {
            var wrapper = $('.form-group');
            $('#btn_talla_add').on('click', function () {
                var row = $(this).parent().parent().clone();
                //Set Hidden and all inputs to "".
                $(row).find('input').val("");
                $(row).find('#btn_talla_add').attr('id', 'btn_talla_remove').find('span').addClass('glyphicon-erase');
                $(this).parent().parent().parent().append(row);
            });
            $(wrapper).on('click', '#btn_talla_remove', function (e) {
    {#                e.preventDefault();#}
                    $(this).parent().parent('div').remove();
                });

                $('#btn_color_add').on('click', function () {
                    var row = $(this).parent().parent().clone();
                    $(row).find('input').val("");
                    $(row).find('#btn_color_add').attr('id', 'btn_color_remove').find('span').addClass('glyphicon-erase');
                    $(this).parent().parent().parent().append(row);
                });
                $(wrapper).on('click', '#btn_color_remove', function (e) {
                    $(this).parent().parent('div').remove();
                });
            });

            //Almacen Cantidad
            $("#almacen_id").change(function () {
                $.post("{{ site_url('items/cantidades_almacen')}}", {item_id: "{{ item_info.item_id }}", almacen_id: $(this).val()},
                function (data) {
                    $("#quantity").val(data.cantidad);
                }, 'json');

            });

            $.post("{{ site_url('items/cantidades_almacen')}}", {item_id: "{{item_info.item_id}}", almacen_id: "{{ selected_almacen}}"},
            function (data) {
                $("#quantity").val(data.cantidad);
            }, 'json');
            $("#category").autocomplete({source: function (request, response) {
                    $.ajax({
                        url: "{{site_url('items/suggest_category')}}",
                        dataType: "json",
                        type: "POST",
                        data: {
                            q: request.term
                        },
                        success: function (data) {
                            response(data);
                        }
                    });
                }});
            $('#item_form').validate({
                submitHandler: function (form) {
                    /*
                     make sure the hidden field #item_number gets set
                     to the visible scan_item_number value
                     */
                    $('#item_number').val($('#scan_item_number').val());
                    //alert($('#item_number').val($('#scan_item_number').val()));
                    $.ajax({
                        type: $(form).attr('method'),
                        url: $(form).attr('action'),
                        data: $(form).serialize(),
                        success: function (response) {
                            tb_remove();
                            post_item_form_submit(response);
                        },
                        dataType: 'json'
                    });

                },
                errorLabelContainer: "#error_message_box",
                wrapper: "li",
                rules:
                        {
                            name: "required",
                            category: "required",
                            cost_price:
                                    {
                                        required: true,
                                        number: true
                                    },
                            unit_price:
                                    {
                                        required: true,
                                        number: true
                                    },
                            tax_percents:
                                    {
                                        number: true
                                    },
                            quantity:
                                    {
                                        required: true,
                                        number: true
                                    },
                            reorder_level:
                                    {
                                        required: true,
                                        number: true
                                    }
                        },
                messages:
                        {
                            name: "{{ line('items_name_required')}}",
                            category: "{{line('items_category_required')}}",
                            cost_price:
                                    {
                                        required: "{{ line('items_cost_price_required')}}",
                                        number: "{{ line('items_cost_price_number')}}"
                                    },
                            unit_price:
                                    {
                                        required: "{{ line('items_unit_price_required')}}",
                                        number: "{{ line('items_unit_price_number')}}"
                                    },
                            tax_percents:
                                    {
                                        number: "{{ line('items_tax_percent_number')}}"
                                    },
                            quantity:
                                    {
                                        required: "{{ line('items_quantity_required')}}",
                                        number: "{{ line('items_quantity_number')}}"
                                    },
                            reorder_level:
                                    {
                                        required: "{{ line('items_reorder_level_required')}}",
                                        number: "{{ line('items_reorder_level_number')}}"
                                    }

                        }
            });
            $('#item_clasifica_form').validate({
                submitHandler: function (form) {
                    $.ajax({
                        type: $(form).attr('method'),
                        url: $(form).attr('action'),
                        data: $(form).serialize(),
                        success: function (response) {
                            //tb_remove();
                            //post_item_form_submit(response);
                            new PNotify({
                                title: 'Mensaje',
                                text: response.message,
                                type: response.success==true?'success':'error'
                            });
                        },
                        dataType: 'json'
                    });

                },
                errorLabelContainer: "#error_message_box",
                wrapper: "li",
                rules: {
                    "talla_nombre[]": "required",
                    "talla_cantidad[]": {"required":true, number: true},
                    "color_cantidad[]": {number: true}
                },
                messages: {
                    "talla_nombre[]": "Talla Requerida",
                    "talla_cantidad[]": "Cantidad Requerida"
                }
            });
        });
</script>