{% extends _layout %}
{% block css %}
    {{parent()}}
     <link rel="stylesheet" href="{{base_url()}}assets/bower_components/datatables/media/css/jquery.dataTables.css"/>
 {%endblock%}
{% block header %}
    {% include 'partials/header.html.twig' %}
{% endblock %}
{% block content %}
    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">{{line('common_list_of')~' '~line('module_'~controller_name)}}</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading"> DataTables Advanced Tables </div>
                    <div class="panel-body">
                        <div class="dataTable_wrapper">

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="title_bar">
            <div id="title" class="float_left">{{line('common_list_of')~' '~line('module_'~controller_name)}}</div>
            <div id="new_button">
                {{ anchor(controller_name~"/view/-1?width="~form_width,
                "<div class='big_button' style='float: left;'><span>"~line(controller_name~'_new')~"</span></div>",
                {'class':'thickbox none','title':line(controller_name~'_new')})}}
                {{anchor(controller_name~"/excel_import?width="~form_width,
                "<div class='big_button' style='float: left;'><span>Excel Import</span></div>",
                {'class':'thickbox none','title':'Import '~ line('module_'~controller_name) ~' from Excel'})}}
            </div>
        </div>
        <div id="table_action_header">
            <ul>
                <li class="float_left"><span>{{ anchor(controller_name~"/delete",line("common_delete"),{'id':'delete'})}}</span></li>
                <li class="float_left"><span><a href="#" id="email">{{line("common_email")}}</a></span></li>
                <li class="float_right">
                    <img src='{{base_url()}}images/spinner_small.gif' alt='spinner' id='spinner' />
                    {{ form_open(controller_name~"/search",{'id':'search_form'})}}
                    <input type="text" name ='search' id='search'/>
                    </form>
                </li>
            </ul>
        </div>
        <div id="table_holder">
            {#manage_table#}

            <div class="demo_jui">
                {{  manage_table }}
                <div class="spacer"></div>
            </div>
        </div>
        <div id="feedback_bar"></div>
    {% endblock %}
    {% block javascript %}
        {{parent()}}
        <script src="{{base_url()}}assets/bower_components/datatables/media/js/jquery.dataTables.js" type="text/javascript" language="javascript" charset="UTF-8"></script>
        <script type="text/javascript">
            var oTable;
            $(document).ready(function ()
            {
                init_table_sorting();
            {#		enable_select_all();#}
            {#		enable_checkboxes();#}
            {#		enable_row_selection();#}
{#            		enable_delete('Esta seguro que desea eliminar el elemento seleccionado?','');	#}
                //enable_bulk_edit("Favor seleccione un usuario para editar","?width=580&height=450");

                oTable = $('#sortable_table').dataTable({
                {#    "bProcessing": true,
                    "bServerSide": true,#}
                    "processing": true,
                    "serverSide": true,
{#                    "bJQueryUI": true,#}
                    "iDisplayLength": 10,
{#                    "sPaginationType": "full_numbers",#}
{#                    "sAjaxSource": 'customers/mis_datos',#}
                    "ajax": 'customers/mis_datos',
                    "aoColumnDefs": [{'bSortable': false, 'aTargets': [0]}],
                    "fnDrawCallback": function () {
                        //tb_init('a.thickbox, area.thickbox, input.thickbox');//pass where to apply thickbox
{#                        tb_init('#sortable_table a.thickbox');#}
{#                        imgLoader = new Image();// preload image#}
                        //imgLoader.src = tb_pathToImage;
            {#				enable_row_selection();#}
                    }
                });
{#                $('#refresh').click(refresca);#}
            });




            $(document).ready(function ()
            {
return true;
                init_table_sorting();
                enable_select_all();
                enable_row_selection();
                enable_search('{{site_url(controller_name~"/suggest")}}', '{{line("common_confirm_search")}}');
                enable_email('{{site_url(controller_name~"/mailto")}}');
                enable_delete('{{line(controller_name~"_confirm_delete")}}', '{{line(controller_name~"_none_selected")}}');
            });

            function init_table_sorting()
            {
                //Only init if there is more than one row
                if ($('.tablesorter tbody tr').length > 1)
                {
                    $("#sortable_table").tablesorter(
                            {
                                sortList: [[1, 0]],
                                headers:
                                        {
                                            0: {sorter: false},
                                            5: {sorter: false}
                                        }

                            });
                }
            }

            function post_person_form_submit(response)
            {
                if (!response.success)
                {
                    set_feedback(response.message, 'error_message', true);
                }
                else
                {
                    //This is an update, just update one row
                    if (jQuery.inArray(response.person_id, get_visible_checkbox_ids()) != -1)
                    {
                        update_row(response.person_id, '{{site_url(controller_name~"/get_row")}}');
                        set_feedback(response.message, 'success_message', false);

                    }
                    else //refresh entire table
                    {
                        do_search(true, function ()
                        {
                            //highlight new row
                            hightlight_row(response.person_id);
                            set_feedback(response.message, 'success_message', false);
                        });
                    }
                }
            }
        </script>
    {%endblock%}